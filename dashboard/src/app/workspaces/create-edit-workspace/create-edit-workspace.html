<che-toolbar che-title="{{createEditWorkspaceController.isCreateMode ? 'New Workspace' : createEditWorkspaceController.workspaceName}}"
             che-title-icons-controller="createEditWorkspaceController"
             che-breadcrumb-title="All workspaces"
             che-breadcrumb-href="#/workspaces">
  <che-button-default ng-if="createEditWorkspaceController.isCreateMode"
                      ng-disabled="createEditWorkspaceController.isCreateButtonDisabled()"
                      che-button-title="Create"
                      ng-click="createEditWorkspaceController.createWorkspace()"></che-button-default>
  <div ng-if="createEditWorkspaceController.isCreateMode === false">
    <che-button-default ng-if="createEditWorkspaceController.editMode === false"
                        che-button-title="Open"
                        href="#/ide/{{createEditWorkspaceController.namespace}}/{{createEditWorkspaceController.workspaceName}}"></che-button-default>
    <workspace-edit-mode-toolbar-button ng-if="createEditWorkspaceController.editMode"
                                        workspace-edit-mode-message="Changes will be applied and workspace restarted"
                                        workspace-edit-mode-show-message="createEditWorkspaceController.showApplyMessage"
                                        workspace-edit-mode-on-save="createEditWorkspaceController.applyConfigChanges()"></workspace-edit-mode-toolbar-button>
  </div>
</che-toolbar>

<md-progress-linear md-mode="indeterminate" ng-show="createEditWorkspaceController.loading"></md-progress-linear>

<md-content md-scroll-y flex
            class="create-edit-workspace-content">
  <md-tabs md-dynamic-height md-stretch-tabs="auto"
           md-selected="createEditWorkspaceController.selectedTabIndex"
           md-center-tabs="">

    <!-- Settings Tab -->
    <md-tab>
      <md-tab-label>
        <md-icon md-font-icon="material-design icon-ic_settings_24px" class="che-tab-label-icon"></md-icon>
        <span class="che-tab-label-title">Settings</span>
      </md-tab-label>
      <md-tab-body ng-init="createEditWorkspaceController.setTab('settings')">
        <div class="create-edit-workspace-tab-content">

          <!-- Name -->
          <che-label-container che-label-name="Name">
            <div layout="column" class="create-edit-workspace-input">
              <ng-form flex layout="column" name="workspaceNameForm">
                <che-input ng-init="createEditWorkspaceController.setForm('settings', workspaceNameForm)"
                           che-form="workspaceNameForm"
                           che-name="name"
                           che-place-holder="Name of the workspace"
                           aria-label="Name of the workspace"
                           ng-model="createEditWorkspaceController.newName"
                           ng-change="createEditWorkspaceController.updateName(workspaceNameForm.$valid)"
                           ng-model-options="{ updateOn: 'default blur', debounce: { 'default': 2000, 'blur': 0 } }"
                           required
                           unique-workspace-name="createEditWorkspaceController.workspaceName"
                           ng-minlength="3"
                           ng-maxlength="20"
                           ng-pattern="/^[A-Za-z0-9_\-\.]+$/">
                  <div ng-message="required">A name is required.</div>
                  <div ng-message="pattern">The name should not contain special characters like space, dollar, etc.
                  </div>
                  <div ng-message="minlength">The name has to be more than 3 characters long.</div>
                  <div ng-message="maxlength">The name has to be less than 20 characters long.</div>
                  <div ng-message="uniqueWorkspaceName">This workspace name is already used.</div>
                </che-input>
              </ng-form>
            </div>
          </che-label-container>

          <!-- Status -->
          <!-- edit mode only -->
          <che-label-container che-label-name="State"
                               ng-if="createEditWorkspaceController.isCreateMode === false">
            <div layout="column">
              <workspace-status che-status="createEditWorkspaceController.getWorkspaceStatus()"></workspace-status>
              <div flex class="create-edit-workspace-description"
                   ng-show="(createEditWorkspaceController.errorMessage)">
                {{createEditWorkspaceController.errorMessage}}
              </div>
              <div layout="row" class="create-edit-workspace-action-buttons">
                <div>
                  <che-button-default ng-disabled="(createEditWorkspaceController.getWorkspaceStatus() === 'STARTING')"
                                      ng-show="(createEditWorkspaceController.getWorkspaceStatus() !== 'RUNNING' && createEditWorkspaceController.getWorkspaceStatus() !== 'STOPPING')"
                                      che-button-title="Run" name="runButton"
                                      ng-click="createEditWorkspaceController.runWorkspace()"></che-button-default>
                  <che-button-default ng-disabled="(createEditWorkspaceController.getWorkspaceStatus() === 'STOPPING')"
                                      ng-show="(createEditWorkspaceController.getWorkspaceStatus() === 'RUNNING' || createEditWorkspaceController.getWorkspaceStatus() === 'STOPPING')"
                                      che-button-title="Stop" name="stopButton"
                                      ng-click="createEditWorkspaceController.stopWorkspace()"></che-button-default>
                </div>
                <div>
                  <che-button-primary-flat ng-disabled="(createEditWorkspaceController.getWorkspaceStatus() !== 'RUNNING')"
                                           che-button-title="Snapshot" name="snapshotButton"
                                           ng-click="createEditWorkspaceController.createSnapshotWorkspace()"></che-button-primary-flat>
                </div>
              </div>
            </div>
          </che-label-container>

          <!-- Export workspace -->
          <!-- edit mode only -->
          <che-label-container che-label-name="Export workspace"
                               ng-if="createEditWorkspaceController.isCreateMode === false">
            <export-workspace workspace-id="{{createEditWorkspaceController.workspaceId}}"
                              workspace-details="createEditWorkspaceController.workspaceDetails"></export-workspace>
          </che-label-container>

          <!-- Delete workspace -->
          <!-- edit mode only -->
          <che-label-container class="create-edit-workspace-delete-label"
                               ng-if="createEditWorkspaceController.isCreateMode === false"
                               che-label-name="Delete workspace"
                               che-label-description="This is irreversible. Deleting your workspace will also delete its projects.">
            <che-button-danger che-button-title="Delete"
                               ng-disabled="!(createEditWorkspaceController.getWorkspaceStatus() === 'RUNNING' || createEditWorkspaceController.getWorkspaceStatus() === 'STOPPED' || createEditWorkspaceController.getWorkspaceStatus() === 'ERROR')"
                               ng-click="createEditWorkspaceController.deleteWorkspace($event)"></che-button-danger>
          </che-label-container>

        </div>
      </md-tab-body>
    </md-tab>

    <!-- Stacks tab -->
    <!-- Creation mode only -->
    <md-tab ng-if="createEditWorkspaceController.isCreateMode">
      <md-tab-label>
        <span class="che-tab-label-title">Stacks</span>
      </md-tab-label>
      <md-tab-body ng-init="createEditWorkspaceController.setTab('stacks')">
        <ng-form name="workspaceStackForm">
          <workspace-stacks ng-init="createEditWorkspaceController.setForm('stacks', workspaceStackForm)"
                            workspace-stack-on-change="createEditWorkspaceController.changeWorkspaceStack(stack, config)"
                            workspace-name="createEditWorkspaceController.newName"></workspace-stacks>
        </ng-form>
      </md-tab-body>
    </md-tab>

    <!-- Runtime Tab -->
    <md-tab ng-if="createEditWorkspaceController.copyWorkspaceDetails.config"
            ng-disabled="createEditWorkspaceController.isRuntimeDisabled()">
      <md-tab-label>
        <span class="che-tab-label-title">Runtime</span>
      </md-tab-label>
      <md-tab-body ng-init="createEditWorkspaceController.setTab('runtime')">
        <ng-form name="workspaceRuntimeForm">
          <workspace-environments
            ng-init="createEditWorkspaceController.setForm('runtime', workspaceRuntimeForm)"
            environment-name="createEditWorkspaceController.copyWorkspaceDetails.config.defaultEnv"
            workspace-config="createEditWorkspaceController.copyWorkspaceDetails.config"
            machines-view-status="createEditWorkspaceController.machinesViewStatus"
            environment-on-change="createEditWorkspaceController.updateWorkspaceConfig()"></workspace-environments>
        </ng-form>
      </md-tab-body>
    </md-tab>

    <!-- Other tabs -->
    <!-- TODO -->
    <md-tab ng-if="createEditWorkspaceController.isCreateMode === false"
            ng-repeat="section in createEditWorkspaceController.getSections()">
      <md-tab-label>
        <md-icon md-font-icon="material-design {{section.icon}}" class="che-tab-label-icon"></md-icon>
        <span class="che-tab-label-title">{{section.title}}</span>
      </md-tab-label>
      <md-tab-body>
        <div che-compile="section.content"></div>
      </md-tab-body>
    </md-tab>
  </md-tabs>
</md-content>

<workspace-edit-mode-overlay ng-if="createEditWorkspaceController.editMode"
                             workspace-edit-mode-message="Changes will be applied and workspace restarted"
                             workspace-edit-mode-show-message="createEditWorkspaceController.showApplyMessage"
                             workspace-edit-mode-on-save="createEditWorkspaceController.applyConfigChanges()"
                             workspace-edit-mode-on-cancel="createEditWorkspaceController.cancelConfigChanges()"></workspace-edit-mode-overlay>

<md-content ng-show="createEditWorkspaceController.invalidWorkspace">
  {{createEditWorkspaceController.invalidWorkspace}}
</md-content>
